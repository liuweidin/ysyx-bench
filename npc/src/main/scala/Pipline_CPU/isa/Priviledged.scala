package Pipline_CPU.isa
import Pipline_CPU._
import Pipline_CPU.frontend._
import Pipline_CPU.backend._

import chisel3.util.BitPat

object Priviledged extends Paramete{

  //privileged instruction
  def ECALL = BitPat("b0000000_00000_00000_000_00000_1110011")

  def MRET = BitPat("b0011000_00010_00000_000_00000_1110011")

  def CSRRS = BitPat("b???????_?????_?????_010_?????_1110011")

  def CSRRW = BitPat("b???????_?????_?????_001_?????_1110011")

  def CSRRC = BitPat("b???????_?????_?????_011_?????_1110011")

  def CSRRCI = BitPat("b???????_?????_?????_111_?????_1110011")
  def CSRRSI = BitPat("b???????_?????_?????_110_?????_1110011")
  def CSRRWI = BitPat("b???????_?????_?????_101_?????_1110011")

  def FENCEI = BitPat("b???????_?????_?????_001_?????_0001111")

  val table = Array(
    CSRRS -> List(InstrType.InstrI, FUType.alu, ALUOPType.csrrs, RD.write),
    CSRRW -> List(InstrType.InstrI, FUType.alu, ALUOPType.csrrw, RD.write),
    ECALL -> List(InstrType.InstrN, FUType.alu, ALUOPType.ecall, RD.NOP),
    MRET -> List(InstrType.InstrN, FUType.alu, ALUOPType.mret, RD.NOP),
    FENCEI -> List(InstrType.InstrI, FUType.alu, ALUOPType.fencei, RD.NOP),
    CSRRC -> List(InstrType.InstrI, FUType.alu, ALUOPType.csrrc, RD.write),
    CSRRCI -> List(InstrType.InstrIC, FUType.alu, ALUOPType.csrrc, RD.write),
    CSRRSI -> List(InstrType.InstrIC, FUType.alu, ALUOPType.csrrs, RD.write),
    CSRRWI -> List(InstrType.InstrIC, FUType.alu, ALUOPType.csrrw, RD.write),
  )
}
